{% extends 'accounts/base.html' %}
{% load static %}

{% block title %}Главная{% endblock %}
{% block header %}
    Калькулятор Ба Цзы
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"> -->
    <link rel="stylesheet" href="{% static 'css/styles.css'%}" type="text/css">
{% endblock %}
    
{% block content %}
{% if user.is_authenticated %}
    
    <p>Сегодня: <strong>{{ current_date_show }}</strong></p>
    
    <!-- <script src="{% static 'js/script.js' %}"></script> -->
    
    
    <!-- Форма для даты -->
    <div class="container">
        <label>Введите дату рождения
            <input type="date" id="birthdayInput" value="{{ current_date|default:'' }}" style="width: 100%; background-color: #eeeeee;" required>
        </label>
        <div id="birthdayResult"></div>
    </div>
    
    <!-- Форма для города (блокируется пока не отправлена дата) -->
    <div class="container">
        <label for="citySelect">Введите город:</label>
        <div>
            <input type="text" id="citySearch" placeholder="Начните вводить..." value="{{ user.city }}"
                autocomplete="on" style="width: 100%; background-color: #eeeeee;">
            </div>
                <select id="citySelect" size="5" style="display: none;">
                    <!-- Варианты будут добавляться динамически -->
                </select>
            <div>
        </div>
        <button id="submitCity" >Отправить город</button>
        <div id="cityResult"></div>
        <label>
            <input type="checkbox" id="changeTime"> Нужен расчёт по административному времени
        </label>
        <div id="checkTime"></div>
    </div>
    

    <div class="container">
        <label>Введите интересующую дату
            <input type="date" id="ourdateInput" value="{{ current_date|default:'' }}" style="width: 100%; background-color: #eeeeee;" disabled required>
        </label>
        <!-- <button id="submitOurdate">Отправить дату</button> -->
        <div id="ourdateResult"></div>
    </div>

    <div class="container">
        <label for="methodSelect">Выберите метод расчета:</label>
        <div>
            <select id="methodSelect" style="width: 100%;
                                            border: none;
                                            background-color: #eeeeee;
                                            border-radius: 10px;
                                            text-align: center; 
                                            height: 40px; 
                                            font-size: 16px;
                                        ">
                {% for method in methods %}
                    <option value="{{ forloop.counter0 }}" style="width: 100%;
                                            max-width: var(--max-width);
                                            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
                                            font-size: 16px;
                                            font-weight: bold;
                                            color: #4e4d4d;
                                            color-scheme: gray;
                                            background-color: white;
                                            box-shadow: #4e4d4d;
                                            border-radius: 10px;
                                            margin-top: 2px;
                                        ">{{ method }}</option>
                {% endfor %}
            </select>
        </div>
        <button id="submitMethod" class="btn btn-primary mt-2">Рассчитать</button>
        <div id="methodResult" class="mt-3"></div>
    </div>
        
    <script>
        // Передаем Django-переменные в JavaScript
        window.processBirthdayUrl = "{% url 'process_birthday' %}";
        window.processCityUrl = "{% url 'process_city' %}";
        window.processOurDateUrl = "{% url 'process_our_date' %}";
        window.processMethodUrl = "{% url 'process_method' %}";
        window.csrfToken = "{{ csrf_token }}";
        window.citiesJson = '{{ cities_json|safe }}';
    </script>
    <script src="{% static 'js/script.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>

    
    {% else %}
    <div style="text-align: center; margin: 30px 0;">
        <p>Для доступа к системы требуется авторизация</p>
        <div style="margin-top: 20px;">
            <a href="{% url 'login' %}" style="display: inline-block; margin: 0 10px;">
                <button>Войти</button>
            </a>
            <a href="{% url 'register' %}" style="display: inline-block; margin: 0 10px;">
                <button>Регистрация</button>
            </a>
        </div>
    </div>
    {% endif %}

{% endblock %}